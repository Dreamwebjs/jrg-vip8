<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JS Bin</title>
<style id="jsbin-css">
*{margin: 0; padding: 0;}
*{box-sizing: border-box;}
ul,li {
	list-style: none;
}
img {
	border: 0;
	vertical-align: middle;
}
a {
	text-decoration: none;
	transition: all .1s ease-in-out;
}
input{
  border: none;
}
body {
	font-family: "Open Sans",sans-serif;
    font-weight: 100;
    color: #475261;
    font-size: 1.3rem;
}
.clearfix:after {
	display: block;
	content: '';
	clear: both;
}
.form-content li.heighterror{
  padding: 4px 5px 2px 9px;
  background: #FFDFDF!important;
  border-bottom: 1px solid #EACBCC;
  border-right: 1px solid #EACBCC;
  margin: 3px 0
}
.form-content{
  padding: 10px 50px 50px;
}
.form-content .panel{
  width: 100%;
  padding: 8px 6px;
  border-top: 1px solid #7c7c7c;
  border-right: 1px solid #c3c3c3;
  border-left: 1px solid #c3c3c3;
  border-bottom: 1px solid #ddd;
}
.form-content .error{
  color: red;
  font-size: 13px;
}
#formbtn{
  display: inline-block;
  padding: 10px 20px;
  font-size: 14px;
  color: #fff;
  background: #E2CB6D;
}
#formbtn:hover{
  background: #eada98;
}

</style>
</head>
<body>
<div class="form-content">
      <form action="">
        <ul>
        <li>  
          <lable class=title for=name>姓名</lable>
          <div>
            <input type="text" class="panel" id=username name="name" placeholder="只能是字母、数字、下划线，3-10个字符">
          </div>
          <p class="nametip error"></p>
          </li>
       <li> 
          <lable class=title for=name>邮箱</lable>
          <div>
            <input type="text" class="panel" id=email name="email" placeholder="mysupermail@mail.com">
          </div>
          <p class="emailtip error"></p>
       </li>
       <li>
        <lable class=title for=conment>留言</lable>
        <div>
          <textarea class="panel" name="conment" id="conment" cols="30" rows="10"></textarea>
       </div>
       </li>
       <li>
        <input type="submit" id=formbtn value="提交">
       </li>
       </ul>
      </form>
  </div>
<script src="forClass.js"></script>
<script src="reg.js"></script>
<script src="ajaxMod.js"></script>
<script id="jsbin-javascript">
var userName = document.querySelector('#username')
var email = document.querySelector('#email')
var usernameTip = document.querySelector('#nametip')
var emailTip = document.querySelector('#emailtip')
var formBtn = document.querySelector('#formbtn')

userName.addEventListener('change',function(){
  if(testUseName()){
    ajax({
      url: 'userName.php',
      type: 'post',
      data: {userName: userName.value},
      success: function (responseText){
        console.log('success已经收到数据了');
        reCheck(responseText);
      },
      error: function(){
        console.log('后台连接错误')
      }
    });
  }else{
    addClass(userName,'error')
  }
});

email.addEventListener('change',function(){
  testEmail()
});
formBtn.addEventListener('click',function(){
  if(testUseName() && testEmail() &&reCheck()){
    console.log('系统正在注册中')
    alert('注册成功')
  }
});

function testUseName(){
  var userName = userName.value;
  if(!regName(userName)){
    userNameTip.innerText = '用户名格式不正确';
    addClass(userNameIpt,'error')
    console.log('本地：用户名输入格式错了，没有发送Ajax')
    return false
  }else{
    userNameTip.innerText =''
    removeClass(userName,'error')
    console.log('本地：用户名输入格式对了')
    return true
  }
}
function testEmail(){
  var email = email.value
  if(!regEmail(email)){
    emailTip.innerText = 'email格式不正确';
    addClass(emailTip,'error')
    console.log('本地：email格式不正确')
    return false
  }else{
    emailTip.innerText = '' 
    removeClass(emailTip,'error')
    console.log('本地：密码符合要求')
    return true
  }
}
function reCheck(responeseText){
  if(responseText.data == true){
    console.log('Ajax: 数据回来了，name有效')
    return true
  }else if(responseText.data === true){
    addClass(userName,'error');
    usernameTip.value = '这个name无效'
    console.log('Ajax: 数据回来了，name无效')
    return false
  }else{
    console.log('本地：Ajax还没回来，急啥')
    return false
  }
}
/*
*这里设定一个最终状态确认，只有当ajax数据之后，并且这个反馈是true的时候，这里才会是true，最终的提交才会提示注册成功
*/

</script>
</body>
</html>